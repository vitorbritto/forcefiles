#!/bin/bash

# PHP Installation Steps: https://php-osx.liip.ch/

# ------------------------------------------------------------------------------
# | PHP Settings                                                               |
# ------------------------------------------------------------------------------

run_php() {

    e_header "Installing PHP 5.6"

    # curl -s https://php-osx.liip.ch/install.sh | bash -s 7.0
    curl -s https://php-osx.liip.ch/install.sh | bash -s 5.6

    # Setup DNSMasq
    e_header "Installing DNSMasq"

    brew install -v dnsmasq

    # The end result here is that any DNS request ending
    # in .dev reply with the IP address 127.0.0.1:
    echo 'address=/.dev/127.0.0.1' > $(brew --prefix)/etc/dnsmasq.conf
    echo 'listen-address=127.0.0.1' >> $(brew --prefix)/etc/dnsmasq.conf
    echo 'port=35353' >> $(brew --prefix)/etc/dnsmasq.conf

    # Start DNSMasq
    ln -sfv $(brew --prefix dnsmasq)/homebrew.mxcl.dnsmasq.plist ~/Library/LaunchAgents
    launchctl load -Fw ~/Library/LaunchAgents/homebrew.mxcl.dnsmasq.plist

    # With DNSMasq running, configure OS X to use your
    # local host for DNS queries ending in .dev:
    sudo mkdir -v /etc/resolver
    sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/dev'
    sudo bash -c 'echo "port 35353" >> /etc/resolver/dev'

    # To test, the command ping -c 3 foodomain.dev should return results from 127.0.0.1.
    # If it doesn't work right away, try turning WiFi off and on (or unplug/plug your ethernet cable), or reboot your system.

    e_header "Installing PHP CS Fixer"
    e_warning "The PHP setting 'phar.readonly' is required to be 'Off' for this formula. Otherwise will probably fail!"

    seek_confirmation "Would you like to install it now?"

    if is_confirmed; then
        brew install homebrew/php/php-cs-fixer
    else
        exit 0

    e_header "Installing PHP Code Sniffer"
    
    brew install homebrew/php/php-code-sniffer

    e_header "Installing Composer"

    brew install homebrew/php/composer

    sudo apachectl restart
    
    e_success "PHP successfully installed!"

}
